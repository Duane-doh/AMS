(function(e){var t=e("#base_url").val()+"static/js/";if(e.fn.ajaxForm==undefined){e.getScript(t+"jquery.form.js")}var n={};n.fileapi=e("<input type='file'/>").get(0).files!==undefined;n.formdata=window.FormData!==undefined;e.fn.uploadFile=function(t){function a(){if(r.afterUploadAll&&!u){u=true;(function e(){if(s.sCounter!=0&&s.sCounter+s.fCounter==s.tCounter){r.afterUploadAll(s);u=false}else window.setTimeout(e,100)})()}}function f(t,n,r){r.on("dragenter",function(t){t.stopPropagation();t.preventDefault();e(this).addClass(n.dragDropHoverClass)});r.on("dragover",function(t){t.stopPropagation();t.preventDefault();var r=e(this);if(r.hasClass(n.dragDropContainerClass)&&!r.hasClass(n.dragDropHoverClass)){r.addClass(n.dragDropHoverClass)}});r.on("drop",function(r){r.preventDefault();e(this).removeClass(n.dragDropHoverClass);t.errorLog.html("");var i=r.originalEvent.dataTransfer.files;if(!n.multiple&&i.length>1){if(n.showError)e("<div class='"+n.errorClass+"'>"+n.multiDragErrorStr+"</div>").appendTo(t.errorLog);return}if(n.onSelect(i)==false)return;h(n,t,i)});r.on("dragleave",function(t){e(this).removeClass(n.dragDropHoverClass)});e(document).on("dragenter",function(e){e.stopPropagation();e.preventDefault()});e(document).on("dragover",function(t){t.stopPropagation();t.preventDefault();var r=e(this);if(!r.hasClass(n.dragDropContainerClass)){r.removeClass(n.dragDropHoverClass)}});e(document).on("drop",function(t){t.stopPropagation();t.preventDefault();e(this).removeClass(n.dragDropHoverClass)})}function l(e){var t="";var n=e/1024;if(parseInt(n)>1024){var r=n/1024;t=r.toFixed(2)+" MB"}else{t=n.toFixed(2)+" KB"}return t}function c(t){var n=[];if(jQuery.type(t)=="string"){n=t.split("&")}else{n=e.param(t).split("&")}var r=n.length;var i=[];var s,o;for(s=0;s<r;s++){n[s]=n[s].replace(/\+/g," ");o=n[s].split("=");i.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])])}return i}function h(t,n,r){for(var i=0;i<r.length;i++){if(!p(n,t,r[i].name)){if(t.showError)e("<div class='"+t.errorClass+"'><b>"+r[i].name+"</b> "+t.extErrorStr+t.allowedTypes+"</div>").appendTo(n.errorLog);continue}if(!t.allowDuplicates&&d(n,r[i].name)){if(t.showError)e("<div class='"+t.errorClass+"'><b>"+r[i].name+"</b> "+t.duplicateErrorStr+"</div>").appendTo(n.errorLog);continue}if(t.maxFileSize!=-1&&r[i].size>t.maxFileSize){if(t.showError)e("<div class='"+t.errorClass+"'><b>"+r[i].name+"</b> "+t.sizeErrorStr+l(t.maxFileSize)+"</div>").appendTo(n.errorLog);continue}if(t.maxFileCount!=-1&&n.selectedFiles>=t.maxFileCount){if(t.showError)e("<div class='"+t.errorClass+"'><b>"+r[i].name+"</b> "+t.maxFileCountErrorStr+t.maxFileCount+"</div>").appendTo(n.errorLog);continue}n.selectedFiles++;n.existingFileNames.push(r[i].name);var s=t;var o=new FormData;var u=t.fileName.replace("[]","");o.append(u,r[i]);var a=t.formData;if(a){var f=c(a);for(var h=0;h<f.length;h++){if(f[h]){o.append(f[h][0],f[h][1])}}}s.fileData=o;var v=new b(n,t);var m="";if(t.showFileCounter)m=n.fileCounter+t.fileCounterStyle+r[i].name;else m=r[i].name;v.filename.html(m);var g=e("<form style='display:block; position:absolute;left: 150px;' class='"+n.formGroup+"' method='"+t.method+"' action='"+t.url+"' enctype='"+t.enctype+"'></form>");g.appendTo("body");var y=[];y.push(r[i].name);w(g,s,v,y,n,r[i]);n.fileCounter++}}function p(e,t,n){var r=t.allowedTypes.toLowerCase().split(",");var i=n.split(".").pop().toLowerCase();if(t.allowedTypes!="*"&&jQuery.inArray(i,r)<0){return false}return true}function d(e,t){var n=false;if(e.existingFileNames.length){for(var i=0;i<e.existingFileNames.length;i++){if(e.existingFileNames[i]==t||r.duplicateStrict&&e.existingFileNames[i].toLowerCase()==t.toLowerCase()){n=true}}}return n}function v(e,t){if(e.existingFileNames.length){for(var n=0;n<t.length;n++){var r=e.existingFileNames.indexOf(t[n]);if(r!=-1){e.existingFileNames.splice(r,1)}}}}function m(e,t){if(e){t.show();var n=new FileReader;n.onload=function(e){t.attr("src",e.target.result)};n.readAsDataURL(e)}}function g(t,n){if(t.showFileCounter){var r=e(".ajax-file-upload-filename").length;n.fileCounter=r+1;e(".ajax-file-upload-filename").each(function(n,i){var s=e(this).html().split(t.fileCounterStyle);var o=parseInt(s[0])-1;var u=r+t.fileCounterStyle+s[1];e(this).html(u);r--})}}function y(t,r,i,s){var o="ajax-upload-id-"+(new Date).getTime();var u=e("<form method='"+i.method+"' action='"+i.url+"' enctype='"+i.enctype+"'></form>");var a="<input type='file' id='"+o+"' name='"+i.fileName+"' accept='"+i.acceptFiles+"'/>";if(i.multiple){if(i.fileName.indexOf("[]")!=i.fileName.length-2){i.fileName+="[]"}a="<input type='file' id='"+o+"' name='"+i.fileName+"' accept='"+i.acceptFiles+"' multiple/>"}var f=e(a).appendTo(u);f.change(function(){t.errorLog.html("");var o=i.allowedTypes.toLowerCase().split(",");var a=[];if(this.files){for(v=0;v<this.files.length;v++){a.push(this.files[v].name)}if(i.onSelect(this.files)==false)return}else{var f=e(this).val();var l=[];a.push(f);if(!p(t,i,f)){if(i.showError)e("<div class='"+i.errorClass+"'><b>"+f+"</b> "+i.extErrorStr+i.allowedTypes+"</div>").appendTo(t.errorLog);return}l.push({name:f,size:"NA"});if(i.onSelect(l)==false)return}g(i,t);s.unbind("click");u.hide();y(t,r,i,s);u.addClass(r);if(n.fileapi&&n.formdata){u.removeClass(r);var c=this.files;h(i,t,c)}else{var d="";for(var v=0;v<a.length;v++){if(i.showFileCounter)d+=t.fileCounter+i.fileCounterStyle+a[v]+"<br>";else d+=a[v]+"<br>";t.fileCounter++}if(i.maxFileCount!=-1&&t.selectedFiles+a.length>i.maxFileCount){if(i.showError)e("<div class='"+i.errorClass+"'><b>"+d+"</b> "+i.maxFileCountErrorStr+i.maxFileCount+"</div>").appendTo(t.errorLog);return}t.selectedFiles+=a.length;var m=new b(t,i);m.filename.html(d);w(u,i,m,a,t,null)}});if(i.nestedForms){u.css({margin:0,padding:0});s.css({position:"relative",overflow:"hidden",cursor:"default"});f.css({position:"absolute",cursor:"pointer",top:"0px",width:"100%",height:"100%",left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"});u.appendTo(s)}else{u.appendTo(e("body"));u.css({margin:0,padding:0,display:"block",position:"absolute",left:"-250px"});if(navigator.appVersion.indexOf("MSIE ")!=-1){s.attr("for",o)}else{s.click(function(){f.click()})}}}function b(t,n){this.statusbar=e("<div class='ajax-file-upload-statusbar'></div>").width(n.statusBarWidth);this.preview=e("<img class='ajax-file-upload-preview' />").width(n.previewWidth).height(n.previewHeight).appendTo(this.statusbar).hide();this.filename=e("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar);this.progressDiv=e("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide();this.progressbar=e("<div class='ajax-file-upload-bar "+t.formGroup+"'></div>").appendTo(this.progressDiv);this.abort=e("<div class='ajax-file-upload-red "+n.abortButtonClass+" "+t.formGroup+"'>"+n.abortStr+"</div>").appendTo(this.statusbar).hide();this.cancel=e("<div class='ajax-file-upload-red "+n.cancelButtonClass+" "+t.formGroup+"'>"+n.cancelStr+"</div>").appendTo(this.statusbar).hide();this.done=e("<div class='ajax-file-upload-green'>"+n.doneStr+"</div>").appendTo(this.statusbar).hide();this.download=e("<div class='ajax-file-upload-green'>"+n.downloadStr+"</div>").appendTo(this.statusbar).hide();this.del=e("<div class='ajax-file-upload-red'>"+n.deletelStr+"</div>").appendTo(this.statusbar).hide();this.clear=e("<div style='clear:both'></div>").appendTo(this.statusbar);if(n.showQueueDiv)e("#"+n.showQueueDiv).append(this.statusbar);else t.errorLog.after(this.statusbar);return this}function w(t,r,i,s,o,u){var f=null;var l={cache:false,contentType:false,processData:false,forceSync:false,type:r.method,data:r.formData,formData:r.fileData,dataType:r.returnType,beforeSubmit:function(e,n,u){if(r.onSubmit.call(this,s)!=false){var f=r.dynamicFormData();if(f){var l=c(f);if(l){for(var h=0;h<l.length;h++){if(l[h]){if(r.fileData!=undefined)u.formData.append(l[h][0],l[h][1]);else u.data[l[h][0]]=l[h][1]}}}}o.tCounter+=s.length;a();return true}i.statusbar.append("<div class='"+r.errorClass+"'>"+r.uploadErrorStr+"</div>");i.cancel.show();t.remove();i.cancel.click(function(){v(o,s);i.statusbar.remove();r.onCancel.call(o,s,i);o.selectedFiles-=s.length;g(r,o)});return false},beforeSend:function(e,t){i.progressDiv.show();i.cancel.hide();i.done.hide();if(r.showAbort){i.abort.show();i.abort.click(function(){v(o,s);e.abort();o.selectedFiles-=s.length})}if(!n.formdata){i.progressbar.width("5%")}else i.progressbar.width("1%")},uploadProgress:function(e,t,n,s){if(s>98)s=98;var o=s+"%";if(s>1)i.progressbar.width(o);if(r.showProgress){i.progressbar.html(o);i.progressbar.css("text-align","center")}},success:function(n,u,a){if(r.returnType=="json"&&e.type(n)=="object"&&n.hasOwnProperty(r.customErrorKeyStr)){i.abort.hide();var f=n[r.customErrorKeyStr];r.onError.call(this,s,200,f,i);if(r.showStatusAfterError){i.progressDiv.hide();i.statusbar.append("<span class='"+r.errorClass+"'>ERROR: "+f+"</span>")}else{i.statusbar.hide();i.statusbar.remove()}o.selectedFiles-=s.length;t.remove();o.fCounter+=s.length;return}o.responses.push(n);i.progressbar.width("100%");if(r.showProgress){i.progressbar.html("100%");i.progressbar.css("text-align","center")}i.abort.hide();r.onSuccess.call(this,s,n,a,i);if(r.showStatusAfterSuccess){if(r.showDone){i.done.show();i.done.click(function(){i.statusbar.hide("slow");i.statusbar.remove()})}else{i.done.hide()}if(r.showDelete){i.del.show();i.del.click(function(){var e=confirm("Are you sure you want to delete "+n+"?");if(e){i.statusbar.hide().remove();if(r.deleteCallback)r.deleteCallback.call(this,n,i);o.selectedFiles-=s.length;g(r,o)}})}else{i.del.hide()}}else{i.statusbar.hide("slow");i.statusbar.remove()}if(r.showDownload){i.download.show();i.download.click(function(){if(r.downloadCallback)r.downloadCallback(n)})}t.remove();o.sCounter+=s.length},error:function(e,n,u){i.abort.hide();if(e.statusText=="abort"){i.statusbar.hide("slow").remove();g(r,o)}else{r.onError.call(this,s,n,u,i);if(r.showStatusAfterError){i.progressDiv.hide();i.statusbar.append("<span class='"+r.errorClass+"'>ERROR: "+u+"</span>")}else{i.statusbar.hide();i.statusbar.remove()}o.selectedFiles-=s.length}t.remove();o.fCounter+=s.length}};if(r.showPreview&&u!=null){if(u.type.toLowerCase().split("/").shift()=="image")m(u,i.preview)}if(r.autoSubmit){t.ajaxSubmit(l)}else{if(r.showCancel){i.cancel.show();i.cancel.click(function(){v(o,s);t.remove();i.statusbar.remove();r.onCancel.call(o,s,i);o.selectedFiles-=s.length;g(r,o)})}t.ajaxForm(l)}}var r=e.extend({url:"",method:"POST",enctype:"multipart/form-data",returnType:null,allowDuplicates:true,duplicateStrict:false,allowedTypes:"*",acceptFiles:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,maxFileCount:-1,multiple:true,dragDrop:true,autoSubmit:true,showCancel:true,showAbort:true,showDone:true,showDelete:false,showError:true,showStatusAfterSuccess:true,showStatusAfterError:true,showFileCounter:false,fileCounterStyle:"). ",showProgress:false,nestedForms:true,showDownload:false,onLoad:function(e){},onSelect:function(e){return true},onSubmit:function(e,t){},onSuccess:function(e,t,n,r){},onError:function(e,t,n,r){},onCancel:function(e,t){},downloadCallback:false,deleteCallback:false,afterUploadAll:false,abortButtonClass:"ajax-file-upload-abort",cancelButtonClass:"ajax-file-upload-cancel",dragDropContainerClass:"ajax-upload-dragdrop",dragDropHoverClass:"state-hover",errorClass:"ajax-file-upload-error",uploadButtonClass:"ajax-file-upload",dragDropStr:"<div class='ajax-dragdrop-label'><h5>Drag & Drop</h5>your files here or upload them manually</div>",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag & Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",duplicateErrorStr:"is not allowed. File already exists.",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:" is not allowed. Maximum no. of allowed files are: ",downloadStr:"Download",customErrorKeyStr:"jquery-upload-file-error",showQueueDiv:false,statusBarWidth:602,dragdropWidth:600,showPreview:false,previewHeight:"auto",previewWidth:"100%",uploadFolder:"uploads/"},t);this.fileCounter=1;this.selectedFiles=0;this.fCounter=0;this.sCounter=0;this.tCounter=0;var i="ajax-file-upload-"+(new Date).getTime();this.formGroup=i;this.hide();this.errorLog=e("<div></div>");this.after(this.errorLog);this.responses=[];this.existingFileNames=[];if(!n.formdata){r.dragDrop=false}if(!n.formdata){r.multiple=false}var s=this;var o=e("<div>"+e(this).html()+"</div>");e(o).addClass(r.uploadButtonClass);(function E(){if(e.fn.ajaxForm){if(r.dragDrop){var t=e('<div class="'+r.dragDropContainerClass+'" style="vertical-align:top;"></div>').width(r.dragdropWidth);e(s).before(t);e(t).append(e(r.dragDropStr));e(t).append(o);f(s,r,t)}else{e(s).before(o)}r.onLoad.call(this,s);y(s,i,r,o)}else window.setTimeout(E,10)})();this.startUpload=function(){e("."+this.formGroup).each(function(t,n){if(e(this).is("form"))e(this).submit()})};this.getFileCount=function(){return s.selectedFiles};this.stopUpload=function(){e("."+r.abortButtonClass).each(function(t,n){if(e(this).hasClass(s.formGroup))e(this).click()})};this.cancelAll=function(){e("."+r.cancelButtonClass).each(function(t,n){if(e(this).hasClass(s.formGroup))e(this).click()})};this.update=function(t){r=e.extend(r,t)};this.createProgress=function(e){var t=new b(this,r);t.progressDiv.show();t.progressbar.width("100%");var n="";if(r.showFileCounter)n=s.fileCounter+r.fileCounterStyle+e;else n=e;t.filename.html(n);s.fileCounter++;s.selectedFiles++;if(r.showPreview){t.preview.attr("src",r.uploadFolder+e);t.preview.show()}if(r.showDownload){t.download.show();t.download.click(function(){if(r.downloadCallback)r.downloadCallback.call(s,[e])})}t.del.show();t.del.click(function(){var n=confirm("Are you sure you want to delete "+e+"?");if(n){t.statusbar.hide().remove();var i=[e];if(r.deleteCallback)r.deleteCallback.call(this,i,t);s.selectedFiles-=1;g(r,s)}})};this.getResponses=function(){return this.responses};var u=false;return this}})(jQuery)